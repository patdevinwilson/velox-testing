<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPC-H SF3000 Graviton Performance Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=NVIDIA+Sans:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0D0D0D 0%, #1A1A1A 50%, #0D0D0D 100%);
            color: #E0E0E0;
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px;
            background: linear-gradient(180deg, rgba(118, 185, 0, 0.15) 0%, transparent 100%);
            border-radius: 20px;
            border: 1px solid rgba(118, 185, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #76B900 0%, #93C90E 50%, #76B900 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: #9E9E9E;
            margin-bottom: 25px;
        }
        
        .badge-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .badge {
            background: linear-gradient(135deg, #76B900 0%, #5A8F00 100%);
            color: #000;
            padding: 10px 24px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(118, 185, 0, 0.4);
        }
        
        .section {
            background: #1E1E1E;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #333;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .section h2 {
            color: #76B900;
            font-size: 1.5rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section h2::before {
            content: '';
            width: 6px;
            height: 28px;
            background: linear-gradient(180deg, #76B900, #93C90E);
            border-radius: 3px;
        }
        
        .chart-container {
            position: relative;
            height: 450px;
            margin: 20px 0;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: linear-gradient(145deg, #252525 0%, #1A1A1A 100%);
            border-radius: 14px;
            padding: 25px;
            border: 1px solid #383838;
            transition: all 0.3s ease;
        }
        
        .summary-card:hover {
            border-color: #76B900;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(118, 185, 0, 0.2);
        }
        
        .summary-card.best {
            border: 2px solid #76B900;
            background: linear-gradient(145deg, rgba(118, 185, 0, 0.1) 0%, #1A1A1A 100%);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .instance-type {
            font-size: 1.3rem;
            font-weight: 700;
            color: #fff;
        }
        
        .node-count {
            background: #333;
            color: #76B900;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #2A2A2A;
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }
        
        .stat-value {
            font-weight: 600;
            color: #E0E0E0;
        }
        
        .stat-value.highlight {
            color: #76B900;
        }
        
        .winner-badge {
            display: inline-block;
            background: linear-gradient(135deg, #76B900 0%, #5A8F00 100%);
            color: #000;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 10px;
        }
        
        .insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .insight-card {
            background: #252525;
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid #76B900;
        }
        
        .insight-title {
            color: #76B900;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .insight-text {
            color: #B0B0B0;
            line-height: 1.6;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 14px 18px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            background: #252525;
            color: #76B900;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background: rgba(118, 185, 0, 0.05);
        }
        
        .fastest {
            color: #76B900;
            font-weight: 700;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .nvidia-logo {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: #76B900;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš¡ TPC-H SF3000 Graviton Performance</h1>
            <p class="subtitle">Presto Native with Velox on AWS Graviton (r7gd) Instances</p>
            <div class="badge-row">
                <span class="badge">3TB Dataset</span>
                <span class="badge">22 Queries</span>
                <span class="badge">NVMe AsyncDataCache</span>
                <span class="badge">ARM64 Native</span>
            </div>
        </header>

        <div class="summary-grid">
            <div class="summary-card best">
                <div class="card-header">
                    <span class="instance-type">r7gd.2xlarge</span>
                    <span class="node-count">32 nodes</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Runtime</span>
                    <span class="stat-value highlight">22.8 min<span class="winner-badge">FASTEST</span></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Hourly Cost</span>
                    <span class="stat-value">$19.35/hr</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Benchmark Cost</span>
                    <span class="stat-value highlight">$7.34<span class="winner-badge">BEST VALUE</span></span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Q21 Runtime</span>
                    <span class="stat-value">191.5s</span>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <span class="instance-type">r7gd.4xlarge</span>
                    <span class="node-count">16 nodes</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Runtime</span>
                    <span class="stat-value">26.0 min</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Hourly Cost</span>
                    <span class="stat-value">$19.35/hr</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Benchmark Cost</span>
                    <span class="stat-value">$8.38</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Q21 Runtime</span>
                    <span class="stat-value">203.6s</span>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <span class="instance-type">r7gd.8xlarge</span>
                    <span class="node-count">8 nodes</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Runtime</span>
                    <span class="stat-value">33.5 min</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Hourly Cost</span>
                    <span class="stat-value">$19.35/hr</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Benchmark Cost</span>
                    <span class="stat-value">$10.82</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Q21 Runtime</span>
                    <span class="stat-value">283.8s</span>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <span class="instance-type">r7gd.16xlarge</span>
                    <span class="node-count">4 nodes</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Runtime</span>
                    <span class="stat-value">42.1 min</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Hourly Cost</span>
                    <span class="stat-value">$19.35/hr</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Benchmark Cost</span>
                    <span class="stat-value">$13.59</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Q21 Runtime</span>
                    <span class="stat-value">365.7s</span>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Query Runtime Comparison</h2>
            <div class="chart-container">
                <canvas id="runtimeChart"></canvas>
            </div>
        </div>

        <div class="section">
            <h2>Cost vs Performance Analysis</h2>
            <div class="chart-container">
                <canvas id="costChart"></canvas>
            </div>
        </div>

        <div class="section">
            <h2>Total Benchmark Runtime</h2>
            <div class="chart-container" style="height: 350px;">
                <canvas id="totalRuntimeChart"></canvas>
            </div>
        </div>

        <div class="section">
            <h2>Query-by-Query Results</h2>
            <table>
                <thead>
                    <tr>
                        <th>Query</th>
                        <th>32Ã— 2xlarge</th>
                        <th>16Ã— 4xlarge</th>
                        <th>8Ã— 8xlarge</th>
                        <th>4Ã— 16xlarge</th>
                    </tr>
                </thead>
                <tbody id="queryTable"></tbody>
            </table>
        </div>

        <div class="section">
            <h2>Key Insights</h2>
            <div class="insights">
                <div class="insight-card">
                    <div class="insight-title">ðŸš€ Parallelization Wins</div>
                    <div class="insight-text">
                        32 smaller workers outperform 4 large workers by 1.85Ã—. More parallelization 
                        provides better throughput for TPC-H workloads, especially for complex 
                        queries like Q21 with large hash table builds.
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">ðŸ’° Same Hourly Cost</div>
                    <div class="insight-text">
                        All configurations cost ~$19.35/hr (same total vCPUs and RAM). 
                        But 32Ã— r7gd.2xlarge finishes in 22.8 min vs 42.1 min for 4Ã— r7gd.16xlarge,
                        making the smaller instances 46% cheaper per benchmark run.
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">âš¡ NVMe AsyncDataCache</div>
                    <div class="insight-text">
                        All r7gd instances include local NVMe storage used for S3 data caching.
                        This significantly reduces repeated S3 reads and improves query performance
                        for data-intensive analytics.
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">ðŸ§  Memory Optimization</div>
                    <div class="insight-text">
                        98% Docker utilization with minimal native overhead enables Q21 to pass
                        on just 8 workers. Proper memory tuning is critical for memory-intensive
                        anti-join queries at SF3000.
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Generated: December 2024 | Presto Native with Velox | AWS Graviton r7gd Instances</p>
        </footer>
    </div>

    <script>
        // NVIDIA Color Palette
        const colors = {
            primary: '#76B900',
            secondary: '#93C90E',
            tertiary: '#5A8F00',
            quaternary: '#A8D600',
            dark: '#1A1A1A',
            grid: '#333333'
        };

        const configColors = [
            'rgba(118, 185, 0, 1)',    // 32Ã— 2xlarge - brightest
            'rgba(147, 201, 14, 1)',   // 16Ã— 4xlarge
            'rgba(90, 143, 0, 1)',     // 8Ã— 8xlarge
            'rgba(168, 214, 0, 0.8)'   // 4Ã— 16xlarge
        ];

        const configColorsAlpha = [
            'rgba(118, 185, 0, 0.8)',
            'rgba(147, 201, 14, 0.8)',
            'rgba(90, 143, 0, 0.8)',
            'rgba(168, 214, 0, 0.6)'
        ];

        // Data
        const queries = ['Q1', 'Q2', 'Q3', 'Q4', 'Q5', 'Q6', 'Q7', 'Q8', 'Q9', 'Q10', 'Q11', 'Q12', 'Q13', 'Q14', 'Q15', 'Q16', 'Q17', 'Q18', 'Q19', 'Q20', 'Q21', 'Q22'];
        
        const data_32x2xl = [45.99, 19.97, 56.43, 42.78, 86.24, 25.45, 73.34, 70.53, 100.18, 52.16, 16.39, 45.42, 36.14, 38.85, 42.34, 12.47, 100.70, 102.58, 56.38, 51.16, 191.54, 17.95];
        const data_16x4xl = [50.07, 25.03, 72.56, 71.16, 96.15, 45.58, 80.79, 74.55, 104.34, 78.22, 17.93, 70.63, 40.48, 61.14, 76.57, 14.65, 114.98, 113.12, 53.42, 74.49, 203.63, 16.51];
        const data_8x8xl = [86.05, 30.46, 99.48, 90.37, 115.61, 54.11, 87.40, 90.69, 146.63, 93.20, 20.35, 76.43, 56.90, 63.77, 95.61, 16.73, 119.35, 190.66, 63.88, 87.45, 283.75, 23.33];
        const data_4x16xl = [81.93, 24.77, 90.15, 91.37, 184.24, 59.06, 90.97, 164.14, 252.82, 97.87, 19.71, 81.69, 58.40, 59.67, 89.90, 17.92, 240.03, 220.00, 88.76, 97.32, 365.74, 30.55];

        // Chart.js default settings
        Chart.defaults.color = '#9E9E9E';
        Chart.defaults.borderColor = colors.grid;

        // Runtime Comparison Chart
        const runtimeCtx = document.getElementById('runtimeChart').getContext('2d');
        new Chart(runtimeCtx, {
            type: 'bar',
            data: {
                labels: queries,
                datasets: [
                    {
                        label: '32Ã— r7gd.2xlarge',
                        data: data_32x2xl,
                        backgroundColor: configColorsAlpha[0],
                        borderColor: configColors[0],
                        borderWidth: 1
                    },
                    {
                        label: '16Ã— r7gd.4xlarge',
                        data: data_16x4xl,
                        backgroundColor: configColorsAlpha[1],
                        borderColor: configColors[1],
                        borderWidth: 1
                    },
                    {
                        label: '8Ã— r7gd.8xlarge',
                        data: data_8x8xl,
                        backgroundColor: configColorsAlpha[2],
                        borderColor: configColors[2],
                        borderWidth: 1
                    },
                    {
                        label: '4Ã— r7gd.16xlarge',
                        data: data_4x16xl,
                        backgroundColor: configColorsAlpha[3],
                        borderColor: configColors[3],
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    },
                    title: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Runtime (seconds)',
                            color: '#76B900'
                        },
                        grid: {
                            color: 'rgba(51, 51, 51, 0.5)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Cost Analysis Chart
        const costCtx = document.getElementById('costChart').getContext('2d');
        new Chart(costCtx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: '32Ã— r7gd.2xlarge',
                        data: [{x: 22.8, y: 7.34}],
                        backgroundColor: configColors[0],
                        borderColor: configColors[0],
                        pointRadius: 20,
                        pointHoverRadius: 25
                    },
                    {
                        label: '16Ã— r7gd.4xlarge',
                        data: [{x: 26.0, y: 8.38}],
                        backgroundColor: configColors[1],
                        borderColor: configColors[1],
                        pointRadius: 18,
                        pointHoverRadius: 23
                    },
                    {
                        label: '8Ã— r7gd.8xlarge',
                        data: [{x: 33.5, y: 10.82}],
                        backgroundColor: configColors[2],
                        borderColor: configColors[2],
                        pointRadius: 16,
                        pointHoverRadius: 21
                    },
                    {
                        label: '4Ã— r7gd.16xlarge',
                        data: [{x: 42.1, y: 13.59}],
                        backgroundColor: configColors[3],
                        borderColor: configColors[3],
                        pointRadius: 14,
                        pointHoverRadius: 19
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw.x} min, $${context.raw.y}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        title: {
                            display: true,
                            text: 'Benchmark Cost ($)',
                            color: '#76B900'
                        },
                        grid: {
                            color: 'rgba(51, 51, 51, 0.5)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Total Runtime (minutes)',
                            color: '#76B900'
                        },
                        grid: {
                            color: 'rgba(51, 51, 51, 0.5)'
                        }
                    }
                }
            }
        });

        // Total Runtime Chart
        const totalCtx = document.getElementById('totalRuntimeChart').getContext('2d');
        new Chart(totalCtx, {
            type: 'bar',
            data: {
                labels: ['32Ã— r7gd.2xlarge', '16Ã— r7gd.4xlarge', '8Ã— r7gd.8xlarge', '4Ã— r7gd.16xlarge'],
                datasets: [{
                    label: 'Total Runtime (minutes)',
                    data: [22.8, 26.0, 33.5, 42.1],
                    backgroundColor: [
                        'rgba(118, 185, 0, 0.9)',
                        'rgba(147, 201, 14, 0.8)',
                        'rgba(90, 143, 0, 0.7)',
                        'rgba(168, 214, 0, 0.6)'
                    ],
                    borderColor: configColors,
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Total Runtime (minutes)',
                            color: '#76B900'
                        },
                        grid: {
                            color: 'rgba(51, 51, 51, 0.5)'
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Populate table
        const tableBody = document.getElementById('queryTable');
        for (let i = 0; i < queries.length; i++) {
            const times = [data_32x2xl[i], data_16x4xl[i], data_8x8xl[i], data_4x16xl[i]];
            const minTime = Math.min(...times);
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><strong>${queries[i]}</strong></td>
                <td class="${times[0] === minTime ? 'fastest' : ''}">${times[0].toFixed(1)}s</td>
                <td class="${times[1] === minTime ? 'fastest' : ''}">${times[1].toFixed(1)}s</td>
                <td class="${times[2] === minTime ? 'fastest' : ''}">${times[2].toFixed(1)}s</td>
                <td class="${times[3] === minTime ? 'fastest' : ''}">${times[3].toFixed(1)}s</td>
            `;
            tableBody.appendChild(row);
        }
    </script>
</body>
</html>

